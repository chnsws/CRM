<!DOCTYPE html>

<html>

	<head>
		<meta charset="utf-8">
		<title>客户</title>
		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="format-detection" content="telephone=no">

		<link rel="stylesheet" href="css/global.css" media="all">
		<script src="{$_GET['public_dir']}/jquery/jquery.js"></script>
		<script src="{$_GET['public_dir']}/jquery-ui/jquery-ui.js"></script>
		<link rel="stylesheet" href="{$_GET['public_dir']}/jquery-ui/jquery-ui.css">
		<link rel="stylesheet" href="{$_GET['public_dir']}/index_js_css/plugins/font-awesome/css/font-awesome.min.css"><!--图标-->



		<link href="{$_GET['public_dir']}/dataTable/css/dataTables.bootstrap.css" rel="stylesheet">
  		<link href="{$_GET['public_dir']}/bootstrap/css/bootstrap.css" rel="stylesheet">

		<script src="{$_GET['public_dir']}/dataTable/js/jquery.dataTables.min.js" ></script>
<script src="{$_GET['public_dir']}/bootstrap/My97DatePicker/WdatePicker.js"'" ></script>
		<script src="{$_GET['public_dir']}/bootstrap/js/bootstrap.js"'" ></script>
		<script src="{$_GET['public_dir']}/dataTable/js/dataTables.
		.js" ></script>

<!--下面   地区插件-->
	
		<link href="{$_GET['public_dir']}/diqu/css/main.css" rel="stylesheet">
		<link href="{$_GET['public_dir']}/diqu/css/css/demo.css" rel="stylesheet">

		<script>window.jQuery || document.write('<script src="{$_GET['public_dir']}/diqu/js/jquery-1.11.0.min.js"><\/script>')</script>
		<script src="{$_GET['public_dir']}/diqu/js/distpicker.data.js"></script>
	    <script src="{$_GET['public_dir']}/diqu/js/distpicker.js"></script>
	    <script src="{$_GET['public_dir']}/diqu/js/main.js"></script>

<!--end!!--><script src="{$_GET['public_dir']}/index_js_css/plugins/layui/layui.js"> </script>
		<link rel="stylesheet" href="{$_GET['public_dir']}/index_js_css/plugins/layui/css/layui.css" media="all">

		 <script>
			window.rooturl="{$_GET['root_dir']}";
		  $(function() {
   				 $( "#tabs" ).tabs();
 		 });

  		</script><!-- 标签-->

  		<link rel="stylesheet" href="{$_GET['public_dir']}/kehucss/xinzeng.css"><!--客户新增CSS-->
		<style>
		body,ul,li,table,tr{margin:0;padding:0;}
		.peizhi{width:auto;height:auto ;border:1px solid #ccc;margin-left:-17px;border-top:0;} 
		.anniu{width:auto;height:50px;border:1px solid #ccc;margin-left:-17px;} 
		.kehu{width:auto;height:auto;border:1px solid #ccc;margin-left:-17px;} 
		tr{line-height:28px}
		.anniudw{  position: relative;top: 14px;}
		.left{  position: relative;left: 13px;}
		.anniudw a{  position: relative; margin-left: 30px;}
		</style>
			  <style>
    			 body { font-size: 62.5%; }
    			 li{overflow:hidden;}

   				#dialog-form label{ float:left; }
   				  #dialog-form input { float:left; }

   				#dialog-form label{ margin-bottom:12px; width:25%;text-align:left;margin-left:18px;padding:.8em;}
   				#sel{width:120px;}
   				 #dialog-form input.text { margin-bottom:12px; width:65%; padding: .8em 0em; }
    			 fieldset { padding:0; border:0; margin-top:25px; }
  				 div#users-contain { width: 350px; margin: 20px 0; }
   				 div#users-contain table { margin: 1em 0; border-collapse: collapse; width: 100%; }
   				 div#users-contain table td, div#users-contain table th { border: 1px solid #eee; padding: .6em 10px; text-align: left;}
    			.ui-dialog .ui-state-error { padding: .3em;}
    			.validateTips { border: 1px solid transparent; padding: 0em;}
    			.ui-dialog .ui-dialog-content {position: relative;border: 0;padding: 0em 0em;background: none;overflow: auto;}
    			#table_local_filter{width:300px;margin-top:-32px; float:right;}
    			#table_local_length{width:100px;}
    			.label-success{ height:28px;line-height:16px;width:60px; text-align: center;font-size:14px }
    			.shaixuan{margin-left:30px;}
    			.pl_bj{margin:0px auto;}


    			
  			 </style>
  			  <script>
							  $(function() {
							    var name = $( "#name" ),
							      email = $( "#email" ),
							      password = $( "#password" ),
							      allFields = $( [] ).add( name ).add( email ).add( password ),
							      tips = $( ".validateTips" );
							 
							    function updateTips( t ) {
							      tips
							        .text( t )
							        .addClass( "ui-state-highlight" );
							      setTimeout(function() {
							        tips.removeClass( "ui-state-highlight", 1500 );
							      }, 500 );
							    }
							 
							    function checkLength( o, n, min, max ) {
							      if ( o.val().length > max || o.val().length < min ) {
							        o.addClass( "ui-state-error" );
							        updateTips( "" + n + " 的长度必须在 " +
							          min + " 和 " + max + " 之间。" );
							        return false;
							      } else {
							        return true;
							      }
							    }
							 
							    function checkRegexp( o, regexp, n ) {
							      if ( !( regexp.test( o.val() ) ) ) {
							        o.addClass( "ui-state-error" );
							        updateTips( n );
							        return false;
							      } else {
							        return true;
							      }
							    }
							 
							    $( "#dialog-form" ).dialog({
							      autoOpen: false,
							      height: 600,
							      width: 520,
							      modal: true,
							      buttons: {
							        "确认添加": function() {
							        		var d = {};
							    			var t = $('form').serializeArray();
							   				 $.each(t, function() {
							   				 	if(this.name.substr(-1,1)==']')
							   				 	{
							   				 		alert(this.name)
							   				 		var linshikey=this.name.replace('[]','');
							   				 		if(d[linshikey]!=undefined)
							   				 		{
							   				 			d[linshikey]=d[linshikey]+'/'+this.value;
							   				 		}
							   				 		else
							   				 		{
							   				 			d[linshikey]=this.value;
							   				 		}
							   				 		
							   				 	}
							   				 	else
							   				 	{
							   				 		d[this.name] = this.value;
							   				 	}
							     			 
							   				 });	
							     			//var zhi=$("#caonm").val();
							     			
							     		alert(JSON.stringify(d));
							     		
							        	$.get(rooturl+'/index.php/Home/Kehu/add',{"id": JSON.stringify(d)},
							        		 function(html){

							        		 	alert(html)
							        		 		if(html=='ok'){
							        		 			alert('添加成功');
							        		 			location.reload();
							        		 		}else{
							        		 			alert('添加失败');
							        		 		}
							                   }
							        		);
							     
							        },
							        取消: function() {
							          $( this ).dialog( "close" );
							        }
							      },
							      close: function() {
							        allFields.val( "" ).removeClass( "ui-state-error" );
							      }
							    });
							 
							    $( "#create-user" )
							      .button()
							      .click(function() {
							        $( "#dialog-form" ).dialog( "open" );
							      });
							  });
							  var aa="";
							  var zhi="";
 		 </script>

		<script type="text/javascript">
        $(function () {
            $("#table_local").dataTable({
                //lengthMenu: [5, 10, 20, 30],//这里也可以设置分页，但是不能设置具体内容，只能是一维或二维数组的方式，所以推荐下面language里面的写法。
                //"
                "sScrollX": "100%",
				"sScrollXInner": "250%",
				"bScrollCollapse": true,
                paging: true,//分页
                ordering: true,//是否启用排序
                searching: true,//搜索
                language: {
                    lengthMenu: '<select class="form-control input-xsmall">' + '<option value="1">1</option>' + '<option value="10">10</option>' + '<option value="20">20</option>' + '<option value="30">30</option>' + '<option value="40">40</option>' + '<option value="50">50</option>' +'<option value="5">5</option>' + '</select>条记录',//左上角的分页大小显示。
                    search: '<span class="label label-success">搜索：</span>',//右上角的搜索文本，可以写html标签

                    paginate: {
                        previous: "上一页",
                        next: "下一页",
                        first: "第一页",
                        last: "最后"
                    },

                    zeroRecords: "没有内容",//table tbody内容为空时，tbody的内容。
                    //下面三者构成了总体的左下角的内容。
                    info: "总共_PAGES_ 页，显示第_START_ 到第 _END_ ，筛选之后得到 _TOTAL_ 条，初始_MAX_ 条 ",//左下角的信息显示，大写的词为关键字。
                    infoEmpty: "0条记录",//筛选为空时左下角的显示。
                    infoFiltered: ""//筛选之后的左下角筛选提示，
                },
                paging: true,
                pagingType: "full_numbers",//分页样式的类型

            });
            $("#table_local_filter input[type=search]").css({ width: "auto" });//右上角的默认搜索文本框，不写这个就超出去了。
        });

    	</script>
    	
 <script>
    		$(document).ready(function(){
    			$(".shaixuan").click(function(){

		alert($(this).attr("name"))
		alert($(this).attr("id"))
    				$.get(rooturl+'/index.php/Home/Kehu/shaixuan',{"title":$(this).attr("name"),"val":$(this).attr("id")},
							        		 				function(html){
							        		 					alert(html)
															$("#jb_bianji").html(html);
															blurfun();

															});

    			});
    		});
    	</script>

	</head>

	<body style="position:relative">
	
		 
		<div id="tabs">
			  <ul>
			    <li><a href="#tabs-1">全部客户</a></li>
			    <li><a href="#tabs-2">我的客户</a></li>
			    <li><a href="#tabs-3">我下属的客户</a></li>
			    
			  </ul>
  			<div id="tabs-1">
  					<li style="margin-top:-36px;margin-left:85%"><button id="create-user">新增用户</button></li>
			   	<div class="peizhi">
				   	<div class="left">
				  
					   	 <div style="margin-top:13px;margin-bottom:13px;line-height:30px" >
					   	 	 	{$new_html}
														
						</div>

					</div>
			   	</div>
   				<div class="anniu">		
					<span style="margin-top:-8px;margin-left:1%"  class="anniudw">
							已选0位客户
					   		<a href="#"  >批量转移</a>
					   		<a href="#"  onclick="bianji_kehu1()">批量编辑</a>
					   		<a href="#" onclick="del_check()">删除所选</a>
					   		<a href="#">转移至客户公海</a>
					</span>
					<div id="bj_kehu" style="margin-top:10px;padding-top:20px;" >
					<form name="pl_bjform" method="post" >
						<table class="pl_bj">
							<tr  style='line-height:70px'>
								<td >选择字段:</td><td><select  style="width:260px;height:26px;" id="show_yc">
												<option>请选择编辑字段</option>
												<foreach name="pl_bj" item="pl_bj">
												<option  value="{$pl_bj.id}">{$pl_bj.name}</option>
												</foreach>
												
											  </select>
												</td>
							</tr>
										{$bj_tab}
							
							
						</table>
					</form>
					</div>
   				</div>
		   		<div class="kehu">   	
		   			<div class="panel panel-default">
			   			 <div class="panel-heading">
				        	 <div class="panel-title">
				            		客户信息
				       		 </div>
			    		</div>
						<div class="panel-body" >
								 <table id="table_local" class="table table-bordered table-striped table-hover">
						            <thead>
						                <tr>	
						                		<th>ID</th>
							                <foreach name="kehu1" item="vo">

							                    <th>{$vo.name}</th> <!--客户标题-->
							                 </foreach>
						                </tr>
						            </thead>
						                <tbody id="jb_bianji">
													{$table}    <!--客户显示信息-->
						                </tbody>			       
						  			</table>
						</div>
					</div>
				</div>
				<div id="dialog-form" title="新增客户">
		  			<p class="validateTips" style="margin:15px 0 0 13px;">所有带*字段都是必填的。</p>
						  <form id="form1"  method="post">
						 		<fieldset>
								  	<foreach name="kehu" item="vo">
								             <li>
								         		<if condition="$vo.bt eq 1">
								             		<label for="name"><span style="color:red">*</span>{$vo.name}:</label>
								             		<if condition="$vo.type eq 3">
								                		<select   name="{$vo.id}">
									                		<foreach name="ywcs_biao" item="vow">	
									                			<if condition="$vow.id eq $vo['id']">
									                			 	<foreach name="vow"  item="voow" key="sq" >
									                			 		<if condition ="$sq eq 'id'">
																			<option style=" padding: .5em 0em;">---请选择---</option>
									                			 		
									                			 		<elseif condition ="$sq neq 'qy'" />
									                						<option value="{$sq}"  >{$voow}</option>
									                					<else>
									                					</if>
									                				</foreach>
									                			</if>
									                		</foreach>
								                		</select>
								                	<elseif condition="$vo.type eq 2" />
								                		<input type="text" name="{$vo.id}"   class="text ui-widget-content ui-corner-all" onfocus="WdatePicker({dateFmt:'yyyy-M-d H:mm:ss'})" >
													<elseif condition="$vo.type eq 1" />
								                	<form class="form-inline">
     													 <div data-toggle="distpicker" style=" overflow:hidden">
       														 <div class="form-group" style="width:33.3%; float:left">
          															<select name="{$vo.id}[]" class="form-control"   ></select>
        													</div>
													        <div class="form-group" style="width:33.3%; float:left">
													          		<select name="{$vo.id}[]" class="form-control"   ></select>
													        </div>
													        <div class="form-group" style="width:33.3%; float:left">
													         	 <select name="{$vo.id}[]" class="form-control"   ></select>
													        </div>
													      </div>
													 </form>
								                	<else />
								                	<input type="text" name="{$vo.id}"  class="text ui-widget-content ui-corner-all" >
								                	</if>
								                <else />
								                	<label for="name">{$vo.name}:</label>
								                	<if condition="$vo.type eq 3">
								                		<select   name="{$vo.id}">
									                		<foreach name="ywcs_biao" item="vow">	
									                			<if condition="$vow.id eq $vo['id']">
									                			 	<foreach name="vow"  item="voow" key="sq" >
									                			 		<if condition ="$sq eq 'id'">
																			<option >---请选择---</option>
									                			 		<else />
									                						<option value="{$sq}"  id="datepicker" >{$voow}</option>
									                					</if>
									                				</foreach>
									                			</if>
									                		</foreach>
								                		</select>

								                	
								                	<else />
								                	<input type="text" name="{$vo.id}"   class="text ui-widget-content ui-corner-all canimei" >
								                	</if>
								                </if>
								                	
								             </li>
													
								    </foreach>
								    		
							  		<li><label for="name"><span style="color:red">*</span>负责人：</label> 
							  				 <select   name="fuzeren">
							  				 	<option>---请选择---</option>
							  				 <foreach name="fuzeren" item="vo"> 
							  				 	<option value="{$vo.user_id}">{$vo.user_name}</option>
							  				  </foreach>   
							  				 </select>
							  		</li>
								   <li><label for="name"><span style="color:red">* </span>部门：
								   <input type="text" name="department"   class="text ui-widget-content ui-corner-all" >
								  </label> 
							  </fieldset>
						  </form>
				</div>
  		</div>
	    <div id="tabs-2">
			</div>   
  <div id="tabs-3">
  
  </div>

</div>
 
	</body>

</html>
<script>
$('#bj_kehu').hide();
$('#yincang_bj').hide();
$('.yincang').hide();
    		function blurfun(){

    			$(".bianji").blur(function(){
    				if($(this).val()==$(this).attr("value")){
    				alert("没有修改信息");
					return false
    				}else{
    					$.get(rooturl+'/index.php/Home/Kehu/index',{"bianji_id":$(this).attr("id"),"bianji_name":$(this).attr("name"),"bianji_val":$(this).val()},
							        		 function(html){
							        		//alert(html)
													if(html=='ok'){
							        		 		
							        		 			$.get(rooturl+'/index.php/Home/Kehu/jb_bianji',{"jb_id":'1'},
							        		 				function(html){
							        		 					alert("老子已经刷新了！")
															$("#jb_bianji").html(html);
															blurfun();

															});

							        		 		}
							                   });

    					
    				}
							        		
    			})
    		}
$(document).ready(blurfun());


function del_check()
{
	var checked_str='';
	var asasd=new Array();
	var as_key=0;
	$(".chbox_duoxuan").each(function(){
		if($(this).prop("checked")==true)
		{
			checked_str+=$(this).prop("id")+',';
			asasd[as_key]=$(this).prop("id");
			as_key++;
		}
	});

	checked_str=checked_str.substr(0,checked_str.length-1);

	$.get(rooturl+'/index.php/Home/Kehu/del_kehu',{"id":checked_str},
							        		 function(html){
							        			alert('删除成功')
							        			for(a=0;a<asasd.length;a++)
							        			{
												
												$("#tr"+asasd[a]).hide();	
							                   	}
							                   });
}

</script>
<script>
function bianji_kehu1()
{
	
	var bianji_str='';
	var bianji=new Array();
	var as_key=0;
	$(".chbox_duoxuan").each(function(){
		if($(this).prop("checked")==true)
		{
			bianji_str+=$(this).prop("id")+',';
		
			as_key++;

				
		}
	});
	
	if(bianji_str=="")
		{
			alert("没有选择客户");
			return false}
	layui.use('layer', function(){
							var layer = layui.layer;
							var win=layer.open({

								type:1,
								offset: 't',
								area:'630px',
								title: '批量编辑客户',
								content:$('#bj_kehu'),
								btn:['确认修改','取消'],
								btn1:function(){
									var xgzd=$("#show_yc").val();
									var content=$("#"+xgzd).val();
								
									var xgzd2=$("#show_yc").children("option[value='"+xgzd+"']").text();//客户名称汉字
									var content2=$("#"+xgzd).children("option[value='"+content+"']").text();//参数汉字

									$.get(rooturl+'/index.php/Home/Kehu/pl_bianji',{"id":bianji_str,"ziduan":xgzd,"content":content,"xgzd2":xgzd2,"content2":content2},
		        		 				function(html){
		        		 					alert("批量修改成功")
												location.reload();
										});


								},
								btn2:function(){
									layer.close(win)
								}
							}); 
						});   
}
$("#show_yc").change(function(){
	
	var show_va=$(this).val();
	$(".yincang").hide()
	$("#wc"+show_va).show();
})
</script>
	   